<!DOCTYPE html>
<html>

<!-- Metadata -->
<head>

    <!-- Basic metadata -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <meta name="description" content="The personal homepage for Jack Morris"> -->

    <!-- OpenGraph protocol markup (see: www.ogp.me) -->
    <meta property="og:title" content="Using K-Dimensional Trees to Optimize Animation Performance" />
    <meta property="og:description" content="       " />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="http://jackxmorris.com/posts/kdtree-visualization" />
    
      <meta property="og:image" content="http://jackxmorris.com/img/home-laptop.jpg" />
    

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">
    <!-- Custom Fonts -->

    

    <!-- Scripts -->
      <!-- D3 -->
      <script src="http://d3js.org/d3.v3.min.js"></script>
      <!-- JQuery -->
      <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
      <!-- Lettering.js -->
      <script src="/scripts/jquery.lettering-0.6.1.min.js"></script>

</head>
<title> Using K-Dimensional Trees to Optimize Animation Performance </title>

<body class="Site">
    <nav class="row jack-navbar">
  <div class="col-lg-6 col-lg-offset-3 col-md-8 col-md-offset-2 col-sm-10 col-sm-offset-1 col-xs-12"> 
    <div class="jack-navbar" href="/">
     <a href="/" id="jack-logo">JackMorris</a>
    </div>
  </div>
  <script>
    /* Style my name using LetteringJS (included on all pages via my header scripts) */


    // Color palette
    var LETTER_COLORS = ['#444', '#363636','#c9c9c9','#dadada','#888','#777'];
    var SHADOW_COLORS = ['#863027', '#9b4d1f','#9c8b26','#427021','#2f597f','#4a4d88'];

    LETTER_COLORS = ['#666'];
    SHADOW_COLORS = ['#aaa'];

    var lettering = function() {
      var elementIndex = 0;
      $("#jack-logo")
        .lettering()
        .children('span')
        .each(function(index, element) {
          var elementCSS = {};

          // color and shadow
          elementCSS['color'] = SHADOW_COLORS[elementIndex % SHADOW_COLORS.length];
          elementCSS['text-shadow'] = LETTER_COLORS[elementIndex % LETTER_COLORS.length] + ' -4px 4px 0';

          // vertical translation and rotations
          var TRANSLATION_LIMIT = 7;
          var ROTATION_LIMIT = 4;
          var translation = Math.random() * (TRANSLATION_LIMIT * 2) - TRANSLATION_LIMIT;
          var rotation = Math.random() * (ROTATION_LIMIT * 2) - ROTATION_LIMIT;
          elementCSS['top'] = '-' + translation + 'px';
          elementCSS['-webkit-transform'] = 'rotate(' + rotation + 'deg)';

          // set CSS on element
          $(element).css(elementCSS);

          // increment index
          elementIndex++;
        });
     }

     var loaded = function() {
      // set up lettering
      lettering();
      // defaults
      $('#jack-logo')
       .hover(
        function() {
        $(this)
          .children()
          .addClass('letter-hover');
       },
        function() {
          $(this)
           .children()
           .removeClass('letter-hover');
        });
     }
     $(loaded);
  </script>
</nav>

    <div class="Site-content">
      <div class="row">

        <article class="post col-lg-6 col-lg-offset-3 col-md-8 col-md-offset-2 col-sm-10 col-sm-offset-1 col-xs-12">

          <header class="post-header">
            <h2 class="post-title" itemprop="name headline">Using K-Dimensional Trees to Optimize Animation Performance</h2>
            <p class="post-meta">
              <time datetime="2016-08-05T11:08:40-04:00" itemprop="datePublished">Aug 5, 2016</time>
              
            </p>
          </header>

        </article>
      </div>
      <!-- text -->
<div class="Site-content" style="padding-bottom: 40px">
  <div class="row">
    <article class="post col-lg-6 col-lg-offset-3 col-md-8 col-md-offset-2 col-sm-10 col-sm-offset-1 col-xs-12">
        Many animations appear simple but actually require complex calculation on each frame. This week, I worked to simplify an animation algorithm using a data structure called
        the k-dimensional tree. To demonstrate k-d trees, I created an HTML canvas visualization of a nearest-neighbor search.
        <br> <br>
        The animation involves a group of nodes floating around inside a container. Each time the user moves the mouse, the node closest to the pointer is highlighted.
        The highlighted node connects to its closest neighbor nodes, which repeat the process to connect to their neighbors. This process recurs up to a certain depth.
        <h4> Problem </h4>
        On each frame, the "dumb" way to create this effect would be by iterating through the nodes and choosing the one with the minimum distance to the user's cursor.
        Although this is a simple algorithm, it requires many calculations each time the user moves the cursor. The computation time of each frame increases
        exponentially with the number of nodes. At a certain point, this load is too heavy for the browser, and the animation starts to skip frames.
        <h4> Solution: K-Dimensional Trees </h4>
        This problem can be solved with data structures called k-dimensional trees. These are similar to binary search trees but support data of arbitary dimensions.
        <br> <br>
        A k-d tree may seem difficult to imagine. To visualize how the tree stores data, let's take the simplest case: one dimension. It turns out that a one-dimensional k-d tree
        is just a binary search tree. Each binary search tree contains a root node with two leaves. In a balanced BST, the root represents the median of the data;
        it splits the data into two equal halves. Down the tree, each node splits its subset of the data in half again.
        <br> <br>
        Now imagine this in two dimensions. Instead of representing a single number, each node represents two: a point on the Cartesian plane. This point also represents
        a line down the center of the data set. (The line is determined based on the k-d tree algorithm and varies by implementation.)
        To split a set of points in two dimensions, you just have to figure out which side of the line each point falls on.
        <br> <br>
        Take this up one more dimension and each node represents a three numbers: a point in a three-dimensional coordinate system. This point is used to determine a plane in three-dimensions.
        Each node in its subtree represents another point in three dimensions. If the tree is balanced, exactly half of the nodes are on one side of the root node's plane and half are on the other.
        <br> <br>
        Now we've taken a one-dimensional tree (a BST) and abstracted it to two and three dimensions. A point became a line and then a plane. It's easy now to take these concepts up to four dimensions. And five.
        All we need for a tree in <i>k</i> dimensions is a set of k-dimensional points and a function that can find the distance between them.
        <br> <br>
        As we know from Binary Search Tree implementations, sorting data into a tree speeds up search dramatically. Each step of search can discard half
        of the data by slicing it down the middle. Therefore, in a tree of <i>k</i> dimensions, the average search time of the data set is reduced from O(<i>n</i>)
        time to O(log <i>n</i>) time.
        <h4> Implementation </h4>
        To create my animation, each node was tagged with an x and y position. All points were sorted into a two-dimensional tree and differentiated with distance formula.
        This means that, in a way, each node represented a line. Each node determined positive or negative distance from its "line" and used this information to sort its descendants
        into two subtrees.
        <br> <br>
        When the user's mouse position changes within the container, the algorithm searches the tree for the nodes closest to the mouse.
        Then, for each of these nodes, it searches for the next-closest nodes. These steps recur until the maximum depth for each frame.
        I've chosen a shallow depth for demonstration purposes.
        <br> <br>
        Computation time could be reduced by pre-computing each node's neighbors. However, in my implementation, I chose to add a bit
        of life by giving each node a slight velocity in a random direction. As such, the list of neighbors could change on each frame and
        must be recomputed.
        <br> <br>
        <h4> Final Product </h4>
        Below is the animation I created using a simple k-d tree implementation. This wouldn't even be usable with so many nodes if
        I had used the "brute force" implementation.
    </article>
  </div>
</div>
<!-- svg       -->
<div id="node-svg-container">
  <div id="mouse-over-me">(mouse over this box)</div>
  <svg id="node-svg"></svg>
</div>

<!-- jquery   -->
<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<!-- d3 js     -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.1.1/d3.js"></script>
<!-- ktree lib -->
<script src="/scripts/kdtree-viz/kdTree.js"></script>
<!-- my script -->
<script src="/scripts/kdtree-viz/script.js"></script>
<style>
  html {
    height: 100%;
    width: 100%;
  }
  body {
    padding: 0;
    margin: 0;
    height: 100%;
    width: 100%;
  }
  #node-svg-container {
    position: relative;
    width: 100%;
    height: 500px;
    margin-bottom: 20px;
    /* background image */
    background-size: cover;
    background-repeat: no-repeat;
    background-image: url('http://cdn.pcwallart.com/images/nasa-space-pictures-hubble-wallpaper-3.jpg');
  }
  #mouse-over-me {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    color: rgba(255,255,255,0.7);
  }
  #node-svg {
    background: rgba(0,0,0,0.65);
    width: 100%;
    height: 100%;
  }
  #node-svg > circle {
    fill: white;
    radius: 2;
  }
  #node-svg > .hidden {
    opacity: 0;
  }
  #node-svg > .shown {
    opacity: 1;
  }
  #node-svg > line {
    stroke: white;
    stroke-width: 2;
  }
</style>

      <br>
      <div class="col-lg-6 col-lg-offset-3 col-md-8 col-md-offset-2 col-sm-10 col-sm-offset-1 col-xs-12">
        
  <div id="disqus">
    <div id="disqus_thread"></div>
  </div>
  <style>
    #disqus {
      padding: 10px;
    }
  </style>
  <script>

  /**
  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
  
  var disqus_config = function () {
    this.page.url = "http://jackxmorris.com/posts/kdtree-visualization";  // Replace PAGE_URL with your page's canonical URL variable
		this.page.identifier = "http://jackxmorris.com/posts/kdtree-visualization"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
  };
  
  (function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = '//jackxmorris.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
 

      </div>
    </div>

    <!-- Footer with social media icons. Code thanks to https://codepen.io/ruandre/pen/howFi -->
<footer> 
    <div class="row">
        <div class="social-media-icons col-lg-6 col-lg-offset-3 col-md-8 col-md-offset-2 col-sm-10 col-sm-offset-1 col-xs-12">
            <div> <!-- RSS -->
                <a href="/feed.xml" class="icon-21 rss" title="RSS">
                    <svg viewBox="0 0 512 512">
                        <path d="M201.8 347.2c0 20.3-16.5 36.8-36.8 36.8 -20.3 0-36.8-16.5-36.8-36.8s16.5-36.8 36.8-36.8C185.3 310.4 201.8 326.8 201.8 347.2zM128.2 204.7v54.5c68.5 0.7 124 56.3 124.7 124.7h54.5C306.7 285.3 226.9 205.4 128.2 204.7zM128.2 166.6c57.9 0.3 112.3 22.9 153.2 63.9 41 41 63.7 95.5 63.9 153.5h54.5c-0.3-149.9-121.7-271.4-271.6-271.9V166.6L128.2 166.6z"/>
                    </svg><!--[if lt IE 9]><em>RSS</em><![endif]-->
                </a>
            </div>
            <div> <!-- Github -->
                <a href="https://github.com/jxmorris12" class="icon-13 github" title="GitHub">
                    <svg viewBox="0 0 512 512">
                        <path d="M256 70.7c-102.6 0-185.9 83.2-185.9 185.9 0 82.1 53.3 151.8 127.1 176.4 9.3 1.7 12.3-4 12.3-8.9V389.4c-51.7 11.3-62.5-21.9-62.5-21.9 -8.4-21.5-20.6-27.2-20.6-27.2 -16.9-11.5 1.3-11.3 1.3-11.3 18.7 1.3 28.5 19.2 28.5 19.2 16.6 28.4 43.5 20.2 54.1 15.4 1.7-12 6.5-20.2 11.8-24.9 -41.3-4.7-84.7-20.6-84.7-91.9 0-20.3 7.3-36.9 19.2-49.9 -1.9-4.7-8.3-23.6 1.8-49.2 0 0 15.6-5 51.1 19.1 14.8-4.1 30.7-6.2 46.5-6.3 15.8 0.1 31.7 2.1 46.6 6.3 35.5-24 51.1-19.1 51.1-19.1 10.1 25.6 3.8 44.5 1.8 49.2 11.9 13 19.1 29.6 19.1 49.9 0 71.4-43.5 87.1-84.9 91.7 6.7 5.8 12.8 17.1 12.8 34.4 0 24.9 0 44.9 0 51 0 4.9 3 10.7 12.4 8.9 73.8-24.6 127-94.3 127-176.4C441.9 153.9 358.6 70.7 256 70.7z"/>
                    </svg><!--[if lt IE 9]><em>GitHub</em><![endif]-->
                </a>
            </div>
            <div> <!-- LinkedIn -->
                <a href="https://www.linkedin.com/in/jack-morris-098090103" class="icon-17 linkedin" title="LinkedIn">
                    <svg viewBox="0 0 512 512">
                        <path d="M186.4 142.4c0 19-15.3 34.5-34.2 34.5 -18.9 0-34.2-15.4-34.2-34.5 0-19 15.3-34.5 34.2-34.5C171.1 107.9 186.4 123.4 186.4 142.4zM181.4 201.3h-57.8V388.1h57.8V201.3zM273.8 201.3h-55.4V388.1h55.4c0 0 0-69.3 0-98 0-26.3 12.1-41.9 35.2-41.9 21.3 0 31.5 15 31.5 41.9 0 26.9 0 98 0 98h57.5c0 0 0-68.2 0-118.3 0-50-28.3-74.2-68-74.2 -39.6 0-56.3 30.9-56.3 30.9v-25.2H273.8z"/>
                    </svg><!--[if lt IE 9]><em>LinkedIn</em><![endif]-->
                </a>
            </div>
            <div> <!-- Twitter -->
                <a href="https://twitter.com/jxmorris12" class="icon-26 twitter" title="Twitter">
                    <svg viewBox="0 0 512 512">
                        <path d="M419.6 168.6c-11.7 5.2-24.2 8.7-37.4 10.2 13.4-8.1 23.8-20.8 28.6-36 -12.6 7.5-26.5 12.9-41.3 15.8 -11.9-12.6-28.8-20.6-47.5-20.6 -42 0-72.9 39.2-63.4 79.9 -54.1-2.7-102.1-28.6-134.2-68 -17 29.2-8.8 67.5 20.1 86.9 -10.7-0.3-20.7-3.3-29.5-8.1 -0.7 30.2 20.9 58.4 52.2 64.6 -9.2 2.5-19.2 3.1-29.4 1.1 8.3 25.9 32.3 44.7 60.8 45.2 -27.4 21.4-61.8 31-96.4 27 28.8 18.5 63 29.2 99.8 29.2 120.8 0 189.1-102.1 185-193.6C399.9 193.1 410.9 181.7 419.6 168.6z"/>
                    </svg><!--[if lt IE 9]><em>Twitter</em><![endif]-->
                </a>
            </div>
        </div>
    </div> 
</footer>

  </body>

</html>
